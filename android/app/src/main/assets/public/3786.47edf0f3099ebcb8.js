"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3786],{3786:(J,O,d)=>{d.r(O),d.d(O,{PhotoProfilePage:()=>H});var v=d(467),C=d(5149),y=d(8458),k=d(4558),i=d(3953),I=d(177),R=d(4341),N=d(8880),g=d(8638),j=d(5079),b=d(5873),p=d(5083),P=function(l){return l.Prompt="PROMPT",l.Camera="CAMERA",l.Photos="PHOTOS",l}(P||{}),w=function(l){return l.Rear="REAR",l.Front="FRONT",l}(w||{}),S=function(l){return l.Uri="uri",l.Base64="base64",l.DataUrl="dataUrl",l}(S||{});class U extends p.E_{getPhoto(o){var s=this;return(0,v.A)(function*(){return new Promise(function(){var c=(0,v.A)(function*(r,t){if(o.webUseInput||o.source===P.Photos)s.fileInputExperience(o,r,t);else if(o.source===P.Prompt){let a=document.querySelector("pwa-action-sheet");a||(a=document.createElement("pwa-action-sheet"),document.body.appendChild(a)),a.header=o.promptLabelHeader||"Photo",a.cancelable=!1,a.options=[{title:o.promptLabelPhoto||"From Photos"},{title:o.promptLabelPicture||"Take Picture"}],a.addEventListener("onSelection",function(){var e=(0,v.A)(function*(n){0===n.detail?s.fileInputExperience(o,r,t):s.cameraExperience(o,r,t)});return function(n){return e.apply(this,arguments)}}())}else s.cameraExperience(o,r,t)});return function(r,t){return c.apply(this,arguments)}}())})()}pickImages(o){var s=this;return(0,v.A)(function*(){return new Promise(function(){var c=(0,v.A)(function*(r,t){s.multipleFileInputExperience(r,t)});return function(r,t){return c.apply(this,arguments)}}())})()}cameraExperience(o,s,c){var r=this;return(0,v.A)(function*(){if(customElements.get("pwa-camera-modal")){const t=document.createElement("pwa-camera-modal");t.facingMode=o.direction===w.Front?"user":"environment",document.body.appendChild(t);try{yield t.componentOnReady(),t.addEventListener("onPhoto",function(){var a=(0,v.A)(function*(e){const n=e.detail;null===n?c(new p.I9("User cancelled photos app")):n instanceof Error?c(n):s(yield r._getCameraPhoto(n,o)),t.dismiss(),document.body.removeChild(t)});return function(e){return a.apply(this,arguments)}}()),t.present()}catch{r.fileInputExperience(o,s,c)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),r.fileInputExperience(o,s,c)})()}fileInputExperience(o,s,c){let r=document.querySelector("#_capacitor-camera-input");const t=()=>{var a;null===(a=r.parentNode)||void 0===a||a.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input",r.type="file",r.hidden=!0,document.body.appendChild(r),r.addEventListener("change",a=>{const e=r.files[0];let n="jpeg";if("image/png"===e.type?n="png":"image/gif"===e.type&&(n="gif"),"dataUrl"===o.resultType||"base64"===o.resultType){const u=new FileReader;u.addEventListener("load",()=>{if("dataUrl"===o.resultType)s({dataUrl:u.result,format:n});else if("base64"===o.resultType){const h=u.result.split(",")[1];s({base64String:h,format:n})}t()}),u.readAsDataURL(e)}else s({webPath:URL.createObjectURL(e),format:n}),t()}),r.addEventListener("cancel",a=>{c(new p.I9("User cancelled photos app")),t()})),r.accept="image/*",r.capture=!0,o.source===P.Photos||o.source===P.Prompt?r.removeAttribute("capture"):o.direction===w.Front?r.capture="user":o.direction===w.Rear&&(r.capture="environment"),r.click()}multipleFileInputExperience(o,s){let c=document.querySelector("#_capacitor-camera-input-multiple");const r=()=>{var t;null===(t=c.parentNode)||void 0===t||t.removeChild(c)};c||(c=document.createElement("input"),c.id="_capacitor-camera-input-multiple",c.type="file",c.hidden=!0,c.multiple=!0,document.body.appendChild(c),c.addEventListener("change",t=>{const a=[];for(let e=0;e<c.files.length;e++){const n=c.files[e];let u="jpeg";"image/png"===n.type?u="png":"image/gif"===n.type&&(u="gif"),a.push({webPath:URL.createObjectURL(n),format:u})}o({photos:a}),r()}),c.addEventListener("cancel",t=>{s(new p.I9("User cancelled photos app")),r()})),c.accept="image/*",c.click()}_getCameraPhoto(o,s){return new Promise((c,r)=>{const t=new FileReader,a=o.type.split("/")[1];"uri"===s.resultType?c({webPath:URL.createObjectURL(o),format:a,saved:!1}):(t.readAsDataURL(o),t.onloadend=()=>{const e=t.result;c("dataUrl"===s.resultType?{dataUrl:e,format:a,saved:!1}:{base64String:e.split(",")[1],format:a,saved:!1})},t.onerror=e=>{r(e)})})}checkPermissions(){var o=this;return(0,v.A)(function*(){if(typeof navigator>"u"||!navigator.permissions)throw o.unavailable("Permissions API not available in this browser");try{return{camera:(yield window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw o.unavailable("Camera permissions are not available in this browser")}})()}requestPermissions(){var o=this;return(0,v.A)(function*(){throw o.unimplemented("Not implemented on web.")})()}pickLimitedLibraryPhotos(){var o=this;return(0,v.A)(function*(){throw o.unavailable("Not implemented on web.")})()}getLimitedLibraryPhotos(){var o=this;return(0,v.A)(function*(){throw o.unavailable("Not implemented on web.")})()}}new U;const A=(0,p.F3)("Camera",{web:()=>new U});var F=d(1125),W=d(8195),X=d(6562),E=d(7669);let z=(()=>{var l,o=new WeakMap,s=new WeakSet;class c{constructor(){(function G(l,o){(0,W.A)(l,o),o.add(l)})(this,s),(0,C.A)(this,o,(0,i.WQX)(F.u))}uploadPhoto(a){var e=this;return(0,v.A)(function*(){const n=new FormData,u=(0,X.A)(s,e,r).call(e,a,"image/jpeg");n.append("photo",u,"image.jpg");const h=yield(0,y.A)(o,e).obtenerToken(),m={url:E.c.serverUrl+"photo/upload",headers:{Authorization:`Bearer ${h}`,"Content-Type":"multipart/form-data"},data:n};try{return yield p.pX.post(m)}catch(f){throw f}})()}uploadPhoto1(a){var e=this;return(0,v.A)(function*(){const n=yield(0,y.A)(o,e).obtenerToken(),h={url:E.c.serverUrl+"photo/upload",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},data:JSON.stringify({photo:`data:image/${a.format};base64,${a.base64String}`})};try{return yield p.pX.post(h)}catch(m){throw m}})()}enviarImagen(){var a=this;return(0,v.A)(function*(){try{const e=yield A.getPhoto({quality:90,allowEditing:!1,resultType:S.Base64,source:P.Camera});if(e.base64String){const n={photo:`data:image/${e.format};base64,${e.base64String}`},u=yield(0,y.A)(o,a).obtenerToken(),h=yield p.pX.post({url:E.c.serverUrl+"photo/upload",data:JSON.stringify(n),headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}});console.log("Respuesta:",h.data)}}catch(e){console.error("Error al enviar la imagen:",e)}})()}}function r(t,a){a=a||"";const e=1024,n=atob(t),u=n.length,h=Math.ceil(u/e),m=new Array(h);for(let f=0;f<h;++f){const T=f*e,M=Math.min(T+e,u),B=new Array(M-T);for(let x=T,L=0;x<M;++L,++x)B[L]=n[x].charCodeAt(0);m[f]=new Uint8Array(B)}return new Blob(m,{type:a})}return(l=c).\u0275fac=function(a){return new(a||l)},l.\u0275prov=i.jDH({token:l,factory:l.\u0275fac,providedIn:"root"}),c})();var D=d(2753);function Q(l,o){if(1&l&&i.nrm(0,"ion-img",8),2&l){const s=i.XpG();i.Y8G("src",s.profile.data.user.photo)}}function Y(l,o){1&l&&(i.j41(0,"ion-thumbnail",9),i.nrm(1,"ion-skeleton-text",15),i.k0s()),2&l&&(i.R7$(),i.Y8G("animated",!0))}let H=(()=>{var l,o=new WeakMap,s=new WeakMap;class c{constructor(){(0,C.A)(this,o,void 0),(0,C.A)(this,s,void 0),this.nav=(0,i.WQX)(N.q9),this.photo="",(0,k.A)(o,this,(0,i.WQX)(z)),this.authService=(0,i.WQX)(F.u),(0,k.A)(s,this,(0,i.WQX)(D.X)),this.loaded=!1,(0,j.a)({arrowBackOutline:b.hGB,cameraOutline:b.GOB,cloudUploadOutline:b.Fb6,imageOutline:b.ETD,arrowBackCircleOutline:b.BiC})}ngOnInit(){this.getProfile(),A.requestPermissions()}back(){this.nav.back()}openGallery(){var t=this;return(0,v.A)(function*(){try{const a=yield A.getPhoto({quality:100,allowEditing:!0,resultType:S.Base64,source:P.Photos});a.base64String?yield(0,y.A)(o,t).uploadPhoto(a.base64String).then(e=>{var n,u,h,m,f;1===(null==e||null===(n=e.data)||void 0===n?void 0:n.success)?(t.photo=null==e||null===(u=e.data)||void 0===u?void 0:u.photo_url,t.authService.showToast(null==e||null===(h=e.data)||void 0===h?void 0:h.message)):(t.authService.showToast(null==e||null===(m=e.data)||void 0===m?void 0:m.message),t.authService.showToast(null==e||null===(f=e.data)||void 0===f||null===(f=f.errors)||void 0===f?void 0:f.photo))}).catch(e=>{var n;t.authService.showToast(null==e||null===(n=e.error)||void 0===n?void 0:n.message)}):console.error("No se pudo obtener la imagen en formato Base64")}catch(a){console.error("Error al tomar la foto",a)}})()}takePicture(){var t=this;return(0,v.A)(function*(){try{const a=yield A.getPhoto({quality:90,allowEditing:!0,resultType:S.Base64,source:P.Camera});a.base64String?yield(0,y.A)(o,t).uploadPhoto1(a).then(e=>{var n,u,h,m,f;1===(null==e||null===(n=e.data)||void 0===n?void 0:n.success)?(t.authService.showToast(null==e||null===(u=e.data)||void 0===u?void 0:u.message),t.authService.showToast("Foto subida con \xe9xito.")):(t.authService.showToast(null==e||null===(h=e.data)||void 0===h?void 0:h.message),t.authService.showToast(null==e||null===(m=e.data)||void 0===m||null===(m=m.errors)||void 0===m?void 0:m.photo),t.authService.showToast("No se pudo subir la foto. Success: "+(null==e||null===(f=e.data)||void 0===f?void 0:f.success)))}).catch(e=>{var n;t.authService.showToast(null==e||null===(n=e.error)||void 0===n?void 0:n.message),t.authService.showToast("Error al subir la foto.")}):(console.error("No se pudo obtener la imagen en formato Base64"),t.authService.showToast("No se pudo obtener la imagen en formato Base64"))}catch(a){console.error("Error al tomar la foto: ",a),t.authService.showToast(`Error al tomar la foto: ${a}`)}})()}getProfile(){(0,y.A)(s,this).profile().then(t=>{this.profile=t.data,1===this.profile.success?this.loaded=!0:(this.authService.showToast("No se encontraron datos."),this.authService.navigateByUrl("auth/login")),403===(null==t?void 0:t.status)&&(this.authService.showToast("No tienes permisos para realizar esta acci\xf3n."),this.authService.navigateByUrl("auth/login")),500===(null==t?void 0:t.status)&&(this.authService.showToast("Error en el servidor, inicie sesi\xf3n nuevamente."),this.authService.navigateByUrl("auth/login"))})}}return(l=c).\u0275fac=function(t){return new(t||l)},l.\u0275cmp=i.VBU({type:l,selectors:[["app-photo-profile"]],standalone:!0,features:[i.aNF],decls:23,vars:3,consts:[[3,"translucent"],[1,"container"],["name","arrow-back-outline","size","large",1,"back",3,"click"],[1,"label"],[3,"fullscreen"],["collapse","condense"],["size","large"],[1,"img"],[1,"profile-img",3,"src"],["slot","start",1,"profile-img"],[1,"toggles"],[1,"foto"],["name","camera-outline",1,"camera",3,"click"],[1,"image"],["name","image-outline",1,"galery",3,"click"],[3,"animated"]],template:function(t,a){1&t&&(i.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"div",1)(3,"ion-icon",2),i.bIt("click",function(){return a.back()}),i.k0s(),i.j41(4,"ion-label",3),i.EFF(5,"Cambiar Estilo"),i.k0s()()()(),i.j41(6,"ion-content",4)(7,"ion-header",5)(8,"ion-toolbar")(9,"ion-title",6),i.EFF(10,"photoProfile"),i.k0s()()(),i.j41(11,"div",7),i.DNE(12,Q,1,1,"ion-img",8)(13,Y,2,1,"ion-thumbnail",9),i.j41(14,"div",10)(15,"div",11)(16,"ion-label"),i.EFF(17,"Tomar Foto"),i.k0s(),i.j41(18,"ion-icon",12),i.bIt("click",function(){return a.takePicture()}),i.k0s()(),i.j41(19,"div",13)(20,"ion-label"),i.EFF(21,"Subir Foto"),i.k0s(),i.j41(22,"ion-icon",14),i.bIt("click",function(){return a.openGallery()}),i.k0s()()()()()),2&t&&(i.Y8G("translucent",!0),i.R7$(6),i.Y8G("fullscreen",!0),i.R7$(6),i.vxM(a.loaded?12:13))},dependencies:[g.Zx,g.ds,g.KW,g.he,g.iq,g.W9,g.eU,g.BC,g.ai,I.MD,R.YN],styles:[".container[_ngcontent-%COMP%]{padding-left:6%;padding-right:8%;width:100%;display:flex;align-items:center;justify-content:space-between}.container[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{flex-grow:1;text-align:center;font-size:23px}.container[_ngcontent-%COMP%]   .back[_ngcontent-%COMP%]{text-align:center}.img[_ngcontent-%COMP%]{padding-top:40%;border-radius:100%}.profile-img[_ngcontent-%COMP%]{width:250px;height:250px;margin:auto}.toggles[_ngcontent-%COMP%]{padding-top:24%;padding-left:15%;padding-right:15%;display:flex;flex-direction:row;justify-content:space-between}.toggles[_ngcontent-%COMP%]   .camera[_ngcontent-%COMP%], .toggles[_ngcontent-%COMP%]   .galery[_ngcontent-%COMP%]{width:80px;height:80px}.toggles[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%], .toggles[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{align-items:center;font-size:19px;display:flex;flex-direction:column}"]}),c})()}}]);