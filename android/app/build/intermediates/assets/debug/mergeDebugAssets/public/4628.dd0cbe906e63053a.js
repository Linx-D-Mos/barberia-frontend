"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4628],{4628:(j,y,i)=>{i.r(y),i.d(y,{ConfirmarCorreoPage:()=>F});var l=i(5149),g=i(8458),d=i(4558),r=i(3953),p=i(177),c=i(4341),u=i(8638),A=i(4831),k=i(9763),T=i(1125),x=i(467),E=i(7669),m=i(5083);let w=(()=>{var n,v=new WeakMap;class h{constructor(){(0,l.A)(this,v,(0,r.WQX)(T.u))}verifyEmail(e){var t=this;return(0,x.A)(function*(){const o=yield(0,g.A)(v,t).obtenerToken(),s={url:E.c.serverUrl+"auth/verify_email",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},data:JSON.stringify(e)};try{return yield m.pX.post(s)}catch(a){throw a}})()}}return(n=h).\u0275fac=function(e){return new(e||n)},n.\u0275prov=r.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),h})();var f=i(6394);function S(n,v){if(1&n&&(r.j41(0,"div",9)(1,"h3"),r.EFF(2,"Ingresa el c\xf3digo de verificaci\xf3n enviado a tu correo"),r.k0s(),r.j41(3,"p"),r.EFF(4),r.k0s()()),2&n){const h=r.XpG();r.R7$(4),r.JRh(null==h.email||null==h.email.datum?null:h.email.datum.email)}}function P(n,v){if(1&n&&(r.j41(0,"div",9)(1,"h3"),r.EFF(2,"Ingresa el c\xf3digo de verificaci\xf3n enviado a tu correo"),r.k0s(),r.j41(3,"p"),r.EFF(4),r.k0s()()),2&n){const h=r.XpG();r.R7$(4),r.JRh(h.email)}}let F=(()=>{var n,v=new WeakMap;class h{constructor(e){(0,l.A)(this,v,void 0),this.route=e,(0,d.A)(v,this,(0,r.WQX)(w)),this.authService=(0,r.WQX)(T.u),this.emailShared=null,this.isVerify=!1,this.contexto="",this.isExist=!1}ngOnInit(){this.emailShared=this.authService.getEmail(),this.verifyForm=new c.gE({email:new c.MJ(this.emailShared,[c.k0.required,c.k0.email]),code:new c.MJ("",[c.k0.required])}),this.route.params.subscribe(e=>{this.contexto=e.contexto,console.log("Valor de contexto:",this.contexto),this.getEmail()}),console.log("Email desde otra p\xe1gina:",this.emailShared)}getEmail(){"registrar"===this.contexto?this.authService.perfil().then(e=>{var t;1===(null==e||null===(t=e.data)||void 0===t?void 0:t.success)?this.email=e.data:this.authService.showAlert("Su token de acceso ya no es v\xe1lido, por favor inicie sesi\xf3n nuevamente.")}).catch(e=>{var t;this.authService.showAlert(null==e||null===(t=e.error)||void 0===t?void 0:t.message)}):"recuperar"===this.contexto&&(this.email=this.authService.getEmail())}verificarCodigo(){if("registrar"==this.contexto&&(this.isVerify=!0,(0,g.A)(v,this).verifyEmail(this.verifyForm.value).then(e=>{var t,o;1===(null==e||null===(t=e.data)||void 0===t?void 0:t.success)?(console.log("Verificaci\xf3n exitosa"),this.authService.navigateByUrl("/auth/login"),this.isVerify=!1,this.verifyForm.reset()):(this.isVerify=!1,this.authService.showToast(null==e||null===(o=e.data)||void 0===o?void 0:o.message))}).catch(e=>{var t;this.isVerify=!1,this.authService.showToast(null==e||null===(t=e.error)||void 0===t?void 0:t.message)})),"recuperar"==this.contexto){this.isExist=!0;const e=this.verifyForm.value;e.reset_password_code=e.code,this.authService.verifyCodeChangePasswd(e).then(t=>{var o,s;1===(null==t||null===(o=t.data)||void 0===o?void 0:o.success)?(console.log("C\xf3digo verificado"),this.authService.navigateByUrl("/auth/cambiar-clave"),this.isExist=!1,this.verifyForm.reset()):(this.isExist=!1,this.authService.showAlert(null==t||null===(s=t.data)||void 0===s?void 0:s.message))}).catch(t=>{var o;console.log(t),this.isExist=!1,this.authService.showAlert(null==t||null===(o=t.error)||void 0===o?void 0:o.message)})}}resendCode(){console.log("Reenviar c\xf3digo")}}return(n=h).\u0275fac=function(e){return new(e||n)(r.rXU(f.nX))},n.\u0275cmp=r.VBU({type:n,selectors:[["app-confirmar-correo"]],standalone:!0,features:[r.aNF],decls:15,vars:5,consts:[[1,"container"],["class","PrimeraParte",4,"ngIf"],[1,"SegundaParte"],[3,"formGroup"],["type","text","formControlName","email",2,"display","none"],["formControlName","code","autofocus","true",2,"gap","4",3,"length","integerOnly"],[1,"opciones"],["color","primary",1,"reenviar-codigo",3,"click"],["color","medium",1,"Confirmar",2,"width","70%",3,"click"],[1,"PrimeraParte"]],template:function(e,t){1&e&&(r.j41(0,"ion-content")(1,"div",0),r.DNE(2,S,5,1,"div",1)(3,P,5,1,"div",1),r.j41(4,"div",2)(5,"form",3),r.nrm(6,"input",4)(7,"p-inputOtp",5),r.k0s()(),r.j41(8,"div",6)(9,"ion-note"),r.EFF(10," \xbfNo has recibido el c\xf3digo? "),r.j41(11,"ion-text",7),r.bIt("click",function(){return t.resendCode()}),r.EFF(12," Reenviar c\xf3digo "),r.k0s()(),r.j41(13,"ion-button",8),r.bIt("click",function(){return t.verificarCodigo()}),r.EFF(14,"Siguiente"),r.k0s()()()()),2&e&&(r.R7$(2),r.Y8G("ngIf","registrar"===t.contexto),r.R7$(),r.Y8G("ngIf","recuperar"===t.contexto),r.R7$(2),r.Y8G("formGroup",t.verifyForm),r.R7$(2),r.Y8G("length",6)("integerOnly",!0))},dependencies:[c.X1,c.qT,c.me,c.BC,c.cb,c.j4,c.JD,k.tm,A._c,A.o$,u.Jm,u.IO,u.JI,u.W9,p.MD,p.bT,c.YN],styles:[".container[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-direction:column;align-items:center;width:100vw;height:100vh;background-color:#f5f5f5}.PrimeraParte[_ngcontent-%COMP%]{display:flex;justify-content:center;flex-direction:column;align-items:center;text-align:center;background-color:#f5f5f5}.PrimeraParte[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:clamp(1rem,2vw + 1rem,2.5rem)}.reenviar-codigo[_ngcontent-%COMP%]{cursor:pointer;text-decoration:none}.reenviar-codigo[_ngcontent-%COMP%]:hover{text-decoration:underline}.opciones[_ngcontent-%COMP%]{display:flex;width:100%;padding:5%;justify-content:center;flex-direction:column;align-items:center;background-color:#f5f5f5;gap:10px}.Siguiente[_ngcontent-%COMP%]{margin-top:2%}"]}),h})()},1125:(j,y,i)=>{i.d(y,{u:()=>w});var l=i(467),g=i(5149),d=i(8458),r=i(4558),p=i(3953),c=i(6394),u=i(5083);const A=(0,u.F3)("Preferences",{web:()=>i.e(2924).then(i.bind(i,2924)).then(f=>new f.PreferencesWeb)});var k=i(8638),T=i(5079),x=i(5873),E=i(4412),m=i(7669);let w=(()=>{var f,S=new WeakMap,P=new WeakMap,F=new WeakMap,n=new WeakMap,v=new WeakMap;class h{constructor(){(0,g.A)(this,S,void 0),(0,g.A)(this,P,void 0),(0,g.A)(this,F,void 0),(0,g.A)(this,n,void 0),(0,g.A)(this,v,void 0),this.emailShared=null,(0,r.A)(S,this,(0,p.WQX)(c.Ix)),(0,r.A)(P,this,(0,p.WQX)(k.hG)),(0,r.A)(F,this,(0,p.WQX)(k.K_)),(0,r.A)(n,this,[]),(0,r.A)(v,this,new E.t(null)),(0,T.a)({alertCircle:x.nVl})}setEmail(e){this.emailShared=e}getEmail(){return this.emailShared}get token(){return(0,d.A)(v,this).asObservable()}actualizarToken(e){(0,d.A)(v,this).next(e)}actualizarTokenEnLocal(e){return(0,l.A)(function*(){yield A.set({key:"token",value:e})})()}establecerToken(e){this.actualizarToken(e),this.actualizarTokenEnLocal(e)}obtenerToken(){return(0,l.A)(function*(){const e=yield A.get({key:"token"});if(!e)throw new Error("Token no encontrado");return e.value})()}eliminarToken(){var e=this;return(0,l.A)(function*(){e.actualizarToken(null),yield A.remove({key:"token"})})()}register(e){var t=this;return(0,l.A)(function*(){const o={url:m.c.serverUrl+"auth/register",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};try{var s;const a=yield u.pX.post(o);return t.establecerToken(null==a||null===(s=a.data)||void 0===s?void 0:s.token),a}catch(a){throw a}})()}login(e){var t=this;return(0,l.A)(function*(){const o={url:m.c.serverUrl+"auth/login",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};try{var s;const a=yield u.pX.post(o);return t.establecerToken(null==a||null===(s=a.data)||void 0===s?void 0:s.token),a}catch(a){throw a}})()}logout(){var e=this;return(0,l.A)(function*(){const t=yield e.obtenerToken(),o={url:m.c.serverUrl+"auth/logout",headers:{Authorization:`Bearer ${t}`}};try{return yield u.pX.get(o)}catch(s){throw s}})()}perfil(){var e=this;return(0,l.A)(function*(){const t=yield e.obtenerToken(),o={url:m.c.serverUrl+"auth/profile",headers:{Authorization:`Bearer ${t}`}};try{return yield u.pX.get(o)}catch(s){throw s}})()}showAlert(e){var t=this;return(0,l.A)(function*(){yield(yield(0,d.A)(P,t).create({header:"Error de Autenticacion",message:e,buttons:["OK"]})).present()})()}navigateByUrl(e){(0,d.A)(S,this).navigateByUrl(e,{replaceUrl:!0})}showToast(e){var t=this;return(0,l.A)(function*(){const o=yield(0,d.A)(F,t).create({message:e,position:"top",positionAnchor:"header",duration:3e3,icon:"alert-circle",color:"primary"});(0,d.A)(n,t).push(o),1===(0,d.A)(n,t).length&&t.showNextToast()})()}showNextToast(){var e=this;return(0,l.A)(function*(){if((0,d.A)(n,e).length>0){const t=(0,d.A)(n,e)[0];yield t.present(),t.onDidDismiss().then(()=>{(0,d.A)(n,e).shift(),e.showNextToast()})}})()}verificarEmail(e){return(0,l.A)(function*(){const t={url:m.c.serverUrl+"auth/send_reset_password_code",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};try{return yield u.pX.post(t)}catch(o){throw o}})()}verifyCodeChangePasswd(e){var t=this;return(0,l.A)(function*(){const o={url:m.c.serverUrl+"auth/verify_reset_password_code",headers:{"Content-Type":"application/json"},data:JSON.stringify(e)};try{var s;const a=yield u.pX.post(o);return t.establecerToken(null==a||null===(s=a.data)||void 0===s?void 0:s.token),a}catch(a){throw a}})()}changePasswd(e){var t=this;return(0,l.A)(function*(){const o=yield t.obtenerToken(),s={url:m.c.serverUrl+"auth/reset_password",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},data:JSON.stringify(e)};try{return yield u.pX.put(s)}catch(a){throw a}})()}}return(f=h).\u0275fac=function(e){return new(e||f)},f.\u0275prov=p.jDH({token:f,factory:f.\u0275fac,providedIn:"root"}),h})()},7669:(j,y,i)=>{i.d(y,{c:()=>l});const l={production:!0,serverUrl:"https://valiant-luck-production.up.railway.app/api/"}}}]);